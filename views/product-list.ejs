<!DOCTYPE html>
<html lang="sv">
  <head>
    <title><%= title %></title>
    <link href="/styles/output.css" rel="stylesheet" />
    <link
      href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;600&family=Jaro&display=swap"
      rel="stylesheet"
    />
  </head>
  <body>
    <%- include('partials/_header') %>

    <main
      class="flex flex-col gap-10 w-full py-16 px-8 md:px-0 max-w-screen-2xl mx-auto md:items-center"
    >
      <h1><%= title %></h1>
      <section class="product-section">
        <div class="product-grid">
          <% if (products.length > 0) { %> <% products.forEach((product) => { %>
          <div class="product-card" data-id="<%= product.id %>">
            <div class="product-grid-container">
              <a href="/products/<%= product.slugs %>">
                <img
                  src="/<%= product.image %>"
                  alt="<%= product.name %> produktbild"
                  class="rounded-lg"
              /></a>
              <div class="icon-container icon-button">
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  fill="none"
                  viewBox="0 0 24 24"
                  stroke-width="1.5"
                  stroke="currentColor"
                  class="add-to-cart-btn size-6"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    d="M15.75 10.5V6a3.75 3.75 0 1 0-7.5 0v4.5m11.356-1.993 1.263 12c.07.665-.45 1.243-1.119 1.243H4.25a1.125 1.125 0 0 1-1.12-1.243l1.264-12A1.125 1.125 0 0 1 5.513 7.5h12.974c.576 0 1.059.435 1.119 1.007ZM8.625 10.5a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Zm7.5 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Z"
                  />
                </svg>
              </div>
            </div>
            <div class="product-information">
              <h2><%= product.name %></h2>
              <p class="price"><%= product.price %> SEK</p>
            </div>
          </div>
          <% }); %> <% } else { %>
          <p class="text-center">Inga produkter hittades i denna kategori.</p>
          <% } %>
        </div>
      </section>
    </main>

    <%- include('partials/_footer') %>
    <script>
const cartAPI = '/api/cart'

document.addEventListener("DOMContentLoaded", () => {
  const cartBadge = document.getElementById("cart-badge");

const syncCartWithBackend = async () => {
  try {
    const res = await fetch(cartAPI),
      backendCart = await res.json();
    cart = backendCart.map(item => ({
      product_id: item.product_id,
      name: item.name,
      quantity: item.quantity,
    }));
    localStorage.setItem("cart", JSON.stringify(cart));
    updateCartBadge();
  } catch (e) {
    console.error("Erreur sync:", e);
  }
};
     // Synchroniser à l'ouverture ou lors de la navigation arrière
     window.addEventListener("pageshow", syncCartWithBackend);

const updateCartBadge = () => {
  const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
  cartBadge.textContent = totalItems;
  cartBadge.style.display = totalItems > 0 ? "flex" : "none";
};
})
</script>
  </body>
</html>
